<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Voice Translator & Assistant</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; max-width: 700px; margin: auto; }
    button { padding: 10px 18px; font-size: 16px; margin: 5px; }
    select, textarea { width: 100%; margin-top: 10px; padding: 10px; font-size: 16px; }
  </style>
</head>
<body>
  <h2>üéôÔ∏è Voice Translator & Assistant</h2>
  <p>Say things like <b>"Translate hello to Tamil"</b>, <b>"What's the weather in Chennai"</b>, or <b>"Give me news"</b>.</p>

  <label for="sourceLang">From:</label>
  <select id="sourceLang">
    <option value="en">English</option>
    <option value="ta">Tamil</option>
    <option value="te">Telugu</option>
    <option value="ml">Malayalam</option>
    <option value="ko">Korean</option>
    <option value="zh-CN">Chinese (Simplified)</option>
    <option value="ar">Arabic</option>
    <option value="es">Spanish</option>
    <option value="fr">French</option>
  </select>

  <label for="targetLang">To:</label>
  <select id="targetLang">
    <option value="en">English</option>
    <option value="ta">Tamil</option>
    <option value="te">Telugu</option>
    <option value="ml">Malayalam</option>
    <option value="ko">Korean</option>
    <option value="zh-CN">Chinese (Simplified)</option>
    <option value="ar">Arabic</option>
    <option value="es">Spanish</option>
    <option value="fr">French</option>
  </select>

  <br><br>
  <button onclick="startVoiceInput()">üé§ Start Speaking</button>

  <h3>Original:</h3>
  <textarea id="originalText" rows="4"></textarea>

  <h3>Response:</h3>
  <textarea id="translatedText" rows="4"></textarea>

<script>
// ‚úÖ Language maps
const recognitionMap = {
  "en": "en-IN", "ta": "ta-IN", "te": "te-IN", "ml": "ml-IN",
  "ko": "ko-KR", "zh-CN": "zh-CN", "ar": "ar-SA",
  "es": "es-ES", "fr": "fr-FR"
};
const ttsMap = {
  "en": "en-US", "ta": "ta-IN", "te": "te-IN", "ml": "ml-IN",
  "ko": "ko-KR", "zh-CN": "zh-CN", "ar": "ar-SA",
  "es": "es-ES", "fr": "fr-FR"
};

// üé§ Start voice input
function startVoiceInput() {
  const sourceLang = document.getElementById("sourceLang").value;
  const recogLang = recognitionMap[sourceLang] || sourceLang;

  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = recogLang;
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  recognition.onresult = async function(event) {
    const spokenText = event.results[0][0].transcript;
    document.getElementById("originalText").value = spokenText;
    await handleCommand(spokenText);
  };

  recognition.onerror = (e) => alert("Speech error: " + e.error);
  recognition.start();
}

// üß† Command Handler
async function handleCommand(text) {
  const lower = text.toLowerCase();

  if (lower.startsWith("translate")) {
    const clean = lower.replace("translate", "").trim();
    const translated = await translateText(clean);
    showResponse(translated);
  }
  else if (lower.includes("weather")) {
    const match = text.match(/weather (?:in)?\s*(.*)/i);
    const city = match && match[1] ? match[1] : "Chennai";
    const weatherInfo = await getWeather(city);
    showResponse(weatherInfo);
  }
  else if (lower.includes("news")) {
    const news = await getNews();
    showResponse(news);
  }
  else {
    showResponse("Sorry, I didn't understand the command.");
  }
}

// üåê Translate
async function translateText(text) {
  const source = document.getElementById("sourceLang").value;
  const target = document.getElementById("targetLang").value;

  try {
    const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${source}|${target}`;
    const response = await fetch(url);
    const data = await response.json();
    return data.responseData.translatedText || "Translation failed.";
  } catch (e) {
    console.error("Translation error:", e);
    return "Error in translation.";
  }
}

// üå¶ Weather API
async function getWeather(city) {
  const apiKey = "YOUR_OPENWEATHER_API_KEY"; // üîë add your API key
  try {
    const url = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&units=metric&appid=${apiKey}`;
    const response = await fetch(url);
    const data = await response.json();
    if (data.cod !== 200) return `Couldn't fetch weather for ${city}`;
    return `Weather in ${city}: ${data.main.temp}¬∞C, ${data.weather[0].description}`;
  } catch (e) {
    return "Error fetching weather.";
  }
}

// üì∞ News API
async function getNews() {
  const apiKey = "YOUR_NEWSAPI_KEY"; // üîë add your NewsAPI key
  try {
    const url = `https://newsapi.org/v2/top-headlines?country=in&pageSize=3&apiKey=${apiKey}`;
    const response = await fetch(url);
    const data = await response.json();
    if (data.status !== "ok") return "Couldn't fetch news.";
    return data.articles.map((a,i) => `${i+1}. ${a.title}`).join("\n");
  } catch (e) {
    console.error("News error:", e);
    return "Error fetching news.";
  }
}

// üîä Speak + Display
function showResponse(text) {
  document.getElementById("translatedText").value = text;
  speakText(text);
}

function speakText(text) {
  const targetLang = document.getElementById("targetLang").value;
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = ttsMap[targetLang] || targetLang;
  speechSynthesis.speak(utter);
}
</script>
</body>
</html>
